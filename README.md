


          
# 俄罗斯方块游戏

一个使用纯HTML、CSS和JavaScript实现的现代化俄罗斯方块游戏。

## 游戏概述
俄罗斯方块是一款经典的益智游戏，本实现使用纯HTML、CSS和JavaScript构建，无需任何外部框架或库。游戏保留了经典俄罗斯方块的核心玩法，同时加入了现代界面设计和增强功能。

## 游戏特点

- 🎮 **经典玩法**：包含7种不同形状的方块，通过旋转和移动来消除行
- 👁️ **方块预览**：显示下一个将出现的方块，帮助玩家提前规划
- 👻 **幽灵方块**：显示当前方块落地位置的半透明提示
- 🔢 **分数系统**：根据消除行数计算得分，并显示当前等级
- 🎚️ **难度选择**：提供初级、中级、高级三种难度选择
- 🎛️ **游戏控制**：支持暂停/继续、重新开始功能

## 操作说明

- ← → : 左右移动方块
- ↑ : 旋转方块
- ↓ : 加速方块下落
- 空格 : 方块直接落到底部
- P : 暂停/继续游戏
- R : 重新开始游戏

## 在线体验

🎮 [点击这里在线体验游戏](https://blog.forminio.cn/e-luo-si-fang-kuai)

## 核心实现逻辑

### 数据结构

1. **游戏板网格**：使用二维数组 `boardGrid` 表示游戏板，0表示空白，非0值表示已固定的方块类型
2. **方块形状**：使用 `SHAPES` 数组存储7种不同形状的方块及其类型
3. **当前方块**：使用 `currentShape`、`currentType`、`currentRow`、`currentCol` 跟踪当前活动方块
4. **下一个方块**：使用 `nextShape` 和 `nextType` 存储下一个将出现的方块

### 游戏流程图

```mermaid
flowchart TD
    A[游戏初始化] --> B{是否开始游戏?}
    B -->|否| C[显示开始界面]
    C --> D[等待用户点击开始按钮]
    D --> E[开始游戏]
    B -->|是| E
    E --> F[生成方块]
    F --> G[绘制游戏板]
    G --> H[游戏循环]
    H --> I{检查碰撞}
    I -->|碰撞| J[固定方块]
    J --> K[检查行消除]
    K --> L{游戏结束?}
    L -->|是| M[显示游戏结束界面]
    M --> N[等待用户重新开始]
    N --> E
    L -->|否| F
    I -->|无碰撞| O[方块下落]
    O --> H
```

### 主要功能模块

#### 1. 游戏初始化

```mermaid
flowchart TD
    A[初始化游戏] --> B[设置游戏参数]
    B --> C[创建游戏板网格]
    C --> D[添加事件监听器]
    D --> E[显示开始界面]
```

游戏初始化时，设置基本参数（行数、列数、方块大小等），创建游戏板网格，并添加键盘和按钮事件监听器。

#### 2. 方块生成与移动

```mermaid
flowchart TD
    A[创建方块] --> B{是否有下一个方块?}
    B -->|是| C[使用下一个方块作为当前方块]
    B -->|否| D[随机生成当前方块]
    C --> E[随机生成下一个方块]
    D --> E
    E --> F[设置初始位置]
    F --> G[绘制当前方块]
    G --> H[绘制下一个方块预览]
    
    I[方块移动] --> J{检查移动是否有效}
    J -->|有效| K[更新位置]
    J -->|无效| L[保持原位]
    K --> M[重绘方块]
    L --> M
```

方块生成时，会随机选择一种形状，并设置初始位置。方块移动时，会先检查移动是否有效（是否会与其他方块或边界碰撞），然后更新位置并重绘。

#### 3. 碰撞检测与方块固定

```mermaid
flowchart TD
    A[碰撞检测] --> B[遍历方块的每个单元]
    B --> C{是否超出边界或与已固定方块重叠?}
    C -->|是| D[返回碰撞]
    C -->|否| E[返回无碰撞]
    
    F[方块固定] --> G[将当前方块合并到游戏板]
    G --> H[检查行消除]
    H --> I[生成新方块]
    I --> J{新方块初始位置是否碰撞?}
    J -->|是| K[游戏结束]
    J -->|否| L[继续游戏]
```

碰撞检测用于判断方块是否可以移动到指定位置。当方块无法继续下落时，会将其固定到游戏板上，然后检查是否有可消除的行，并生成新的方块。

#### 4. 行消除与分数计算

```mermaid
flowchart TD
    A[检查行消除] --> B[从底部向上遍历每一行]
    B --> C{行是否已满?}
    C -->|是| D[移除该行]
    D --> E[在顶部添加新行]
    E --> F[增加消除行数计数]
    C -->|否| G[继续检查下一行]
    F --> H[计算得分]
    H --> I[更新等级]
    I --> J[更新游戏速度]
```

当一行被方块填满时，该行会被消除，并在顶部添加新的空行。消除行数会影响得分和游戏等级，等级提升会加快方块下落速度。

#### 5. 用户交互

```mermaid
flowchart TD
    A[键盘事件处理] --> B{按键类型?}
    B -->|左右箭头| C[尝试左右移动]
    B -->|上箭头| D[尝试旋转]
    B -->|下箭头| E[加速下落]
    B -->|空格| F[直接落到底部]
    B -->|P键| G[暂停/继续游戏]
    B -->|R键| H[重新开始游戏]
    
    I[按钮事件处理] --> J{按钮类型?}
    J -->|开始游戏| K[开始新游戏]
    J -->|重新开始| L[重置游戏状态]
    J -->|暂停| M[暂停/继续游戏]
    J -->|难度选择| N[调整游戏速度]
```

游戏支持键盘和按钮操作，用户可以通过键盘控制方块移动、旋转和加速下落，也可以通过按钮开始、暂停和重新开始游戏，以及选择难度级别。

## 核心功能详解

### 1. 方块旋转算法

方块旋转是通过矩阵转置和行反转实现的：

```mermaid
flowchart TD
    A[旋转方块] --> B[创建方块矩阵副本]
    B --> C[计算新矩阵尺寸]
    C --> D[创建新矩阵]
    D --> E[填充新矩阵]
    E --> F[检查旋转后是否碰撞]
    F -->|无碰撞| G[应用旋转]
    F -->|有碰撞| H[尝试墙踢]
    H -->|成功| G
    H -->|失败| I[保持原状]
```

旋转算法会创建方块矩阵的副本，然后进行90度旋转。如果旋转后的位置发生碰撞，会尝试"墙踢"（wall kick）操作，即尝试向左右移动以适应旋转。

### 2. 幽灵方块实现

幽灵方块是当前方块在不移动的情况下，能够下落到的最低位置的半透明提示：

```mermaid
flowchart TD
    A[绘制幽灵方块] --> B[移除之前的幽灵方块]
    B --> C[复制当前方块位置]
    C --> D[向下移动直到碰撞]
    D --> E{幽灵位置是否与当前位置不同?}
    E -->|是| F[绘制半透明幽灵方块]
    E -->|否| G[不绘制幽灵方块]
```

幽灵方块通过模拟当前方块下落直到碰撞来确定位置，然后在该位置绘制半透明的方块，帮助玩家规划落点。

### 3. 游戏状态管理

游戏状态管理包括开始、暂停、继续和结束状态的处理：

```mermaid
flowchart TD
    A[游戏状态管理] --> B{当前状态?}
    B -->|未开始| C[显示开始界面]
    B -->|进行中| D[运行游戏循环]
    B -->|暂停| E[暂停游戏循环]
    B -->|结束| F[显示游戏结束界面]
    
    C --> G[等待开始按钮点击]
    G --> H[初始化游戏]
    H --> D
    
    D --> I[处理用户输入]
    I --> J[更新游戏状态]
    J --> D
    
    E --> K[等待继续按钮点击]
    K --> D
    
    F --> L[等待重新开始按钮点击]
    L --> H
```

游戏状态管理确保游戏在不同状态下有正确的行为，例如在暂停状态下停止方块下落，在游戏结束状态下显示结束界面等。

## 实现亮点

1. **模块化设计**：游戏逻辑被分解为多个功能模块，如方块生成、碰撞检测、行消除等，使代码结构清晰。

2. **响应式界面**：游戏界面使用CSS实现响应式设计，适配不同屏幕尺寸。

3. **高效渲染**：使用DOM操作而非Canvas绘制，通过只更新变化的部分来提高性能。

4. **增强游戏体验**：添加了幽灵方块、方块预览、难度选择等功能，提升游戏体验。

5. **状态管理**：实现了完整的游戏状态管理，包括开始、暂停、继续和结束状态。

      
